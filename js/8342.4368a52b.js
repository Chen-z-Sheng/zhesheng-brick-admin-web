"use strict";(self.webpackChunkvue_admin_better=self.webpackChunkvue_admin_better||[]).push([["8342"],{46729:function(e,a,t){async function n(e,{method:a="GET",body:t}={}){let l=await fetch(`/api${e}`,{method:a,headers:t?{"Content-Type":"application/json"}:void 0,body:t?JSON.stringify(t):void 0,credentials:"include"});if(!l.ok){let e=await l.text().catch(()=>"");throw Error(`HTTP ${l.status}: ${e||l.statusText}`)}return 204===l.status?null:l.json()}function l(e={}){let a=new URLSearchParams(e).toString();return n(`/templates${a?`?${a}`:""}`)}function r(e){return n(`/templates/${e}`)}function u(e){return n("/templates",{method:"POST",body:e})}function o(e,a){return n(`/templates/${e}`,{method:"PUT",body:a})}function i(e){return n(`/templates/${e}`,{method:"DELETE"})}function d(e){return n(`/templates/${e}/duplicate`,{method:"POST"})}function s(e,a={}){let t=new URLSearchParams(a).toString();return n(`/templates/${e}/render${t?`?${t}`:""}`)}t.r(a),t.d(a,{createTemplate:function(){return u},deleteTemplate:function(){return i},duplicateTemplate:function(){return d},getTemplateDetail:function(){return r},getTemplateRender:function(){return s},getTemplates:function(){return l},updateTemplate:function(){return o}})},99912:function(e,a,t){var n=t(26741),l=t.n(n),r=t(63494),u=t.n(r)()(l());u.push([e.id,".designer-page[data-v-7f9cd3e7]{display:flex;flex-direction:column;padding:12px;height:100%}.topbar[data-v-7f9cd3e7]{display:flex;align-items:center;gap:8px;margin-bottom:12px}.viewport[data-v-7f9cd3e7]{height:calc(100vh - 120px);min-height:480px;overflow:auto;display:grid;place-content:start center;background:#fff;border:1px solid #ebeef5;border-radius:8px}.scale[data-v-7f9cd3e7]{width:100%;height:100%}.root[data-v-7f9cd3e7]{width:100%;min-height:560px;display:block}.w-56[data-v-7f9cd3e7]{width:260px}.w-40[data-v-7f9cd3e7]{width:200px}.w-72[data-v-7f9cd3e7]{width:320px}.grow[data-v-7f9cd3e7]{flex:1}.preview-missing[data-v-7f9cd3e7]{font-size:13px;color:#666;background:#f9fafb;border:1px dashed #e5e7eb;border-radius:8px;padding:12px;white-space:pre-wrap}",""]),a.A=u},36853:function(e,a,t){t.r(a),t.d(a,{default:function(){return R}});var n=t(65611),l=t(10365),r=t(67312),u=t(46729);let o={class:"designer-page"},i={class:"topbar"},d={class:"viewport"},s={key:0,class:"preview-missing"};var c=t(66270),p=t.n(c),m=t(38007),f=t.n(m),v=t(92669),g=t.n(v),w=t(23566),h=t.n(w),b=t(76106),y=t.n(b),k=t(12527),x=t.n(k),T=t(99912),_={};_.styleTagTransform=x(),_.setAttributes=h(),_.insert=g().bind(null,"head"),_.domAPI=f(),_.insertStyleElement=y(),p()(T.A,_),T.A&&T.A.locals&&T.A.locals;var R=(0,t(4786).default)({__name:"index",setup(e){let a=(0,l.lq)(),t=(0,l.rd)(),c=(0,n.KR)(a.query.id?String(a.query.id):null),p=(0,n.EW)(()=>"new"===a.query.mode||!c.value),m=(0,n.KR)(null),f=(0,n.KR)({name:"",teamName:"",description:""}),v=(0,n.KR)(!1),g=(0,n.KR)(.9),w=(0,n.EW)(()=>({transform:`scale(${g.value})`,transformOrigin:"top center"})),h=(0,n.KR)(!1),b=(0,n.KR)({}),y=(0,n.KR)([]),k=(0,n.KR)({}),x=!!("undefined"!=typeof window&&(window.formCreate||window.$formCreate));async function T(){let e=m.value?.getRule?.()||[],a=m.value?.getOption?.()||[];if(!f.value.name||!f.value.teamName)return void r.n.warning("请填写模板名称和团队名称");v.value=!0;try{p.value?(await (0,u.createTemplate)({name:f.value.name,teamName:f.value.teamName,description:f.value.description,rule_json:e,option_json:a}),r.n.success("模板创建成功"),t.back()):(await (0,u.updateTemplate)(c.value,{name:f.value.name,teamName:f.value.teamName,description:f.value.description,rule_json:e,option_json:a}),r.n.success("模板更新成功"))}catch(e){r.n.error("保存失败："+(e?.message||"接口异常"))}finally{v.value=!1}}function _(){if(!x){r.n.warning("未注册 form-create 渲染器，无法预览"),h.value=!0;return}y.value=m.value?.getRule?.()||[],k.value=m.value?.getOption?.()||{},h.value=!0}function R(){t.back()}return(0,n.sV)(async()=>{if(!p.value&&c.value)try{let e=await (0,u.getTemplateDetail)(c.value);f.value={name:e.name||"",teamName:e.teamName||"",description:e.description||""},await (0,n.dY)(),m.value?.setRule?.(e.rule_json||[]),m.value?.setOption?.(e.option_json||{})}catch(e){r.n.error("加载模板失败："+(e?.message||"接口异常"))}"true"===a.query.preview&&_()}),(e,a)=>{let t=(0,n.g2)("el-page-header"),l=(0,n.g2)("el-input"),r=(0,n.g2)("el-button"),u=(0,n.g2)("fc-designer"),c=(0,n.g2)("form-create"),g=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)("div",o,[(0,n.Q3)(" 顶部工具栏 "),(0,n.Lk)("div",i,[(0,n.bF)(t,{onBack:R},{content:(0,n.k6)(()=>[(0,n.Lk)("span",null,(0,n.v_)(p.value?"新建模板":"编辑模板"),1)]),_:1}),a[7]||(a[7]=(0,n.Lk)("div",{class:"grow"},null,-1)),(0,n.bF)(l,{modelValue:f.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value.name=e),placeholder:"模板名称",class:"w-56"},null,8,["modelValue"]),(0,n.bF)(l,{modelValue:f.value.teamName,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value.teamName=e),placeholder:"团队名称",class:"w-40"},null,8,["modelValue"]),(0,n.bF)(l,{modelValue:f.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value.description=e),placeholder:"模板描述",class:"w-72"},null,8,["modelValue"]),(0,n.bF)(r,{loading:v.value,type:"primary",onClick:T},{default:(0,n.k6)(()=>[...a[5]||(a[5]=[(0,n.eW)("保存",-1)])]),_:1},8,["loading"]),(0,n.bF)(r,{onClick:_},{default:(0,n.k6)(()=>[...a[6]||(a[6]=[(0,n.eW)("预览",-1)])]),_:1})]),(0,n.Q3)(" 设计器视口 "),(0,n.Lk)("div",d,[(0,n.Lk)("div",{class:"scale",style:(0,n.Tr)(w.value)},[(0,n.bF)(u,{ref_key:"designerRef",ref:m,class:"root"},null,512)],4)]),(0,n.Q3)(" 预览弹窗（需要已注册 form-create 渲染器） "),(0,n.bF)(g,{modelValue:h.value,"onUpdate:modelValue":a[4]||(a[4]=e=>h.value=e),width:"70%",title:"表单预览","destroy-on-close":""},{default:(0,n.k6)(()=>[x?((0,n.uX)(),(0,n.Wv)(c,{key:1,modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=e=>b.value=e),rule:y.value,option:k.value},null,8,["modelValue","rule","option"])):((0,n.uX)(),(0,n.CE)("div",s,[...a[8]||(a[8]=[(0,n.eW)(" 未检测到 form-create 渲染器。请在 main.js 注册后再试： ",-1),(0,n.Lk)("pre",null,"import formCreate from '@form-create/element-ui'\napp.use(formCreate)",-1)])]))]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-7f9cd3e7"]])}}]);