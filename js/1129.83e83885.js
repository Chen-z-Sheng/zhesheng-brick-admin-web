"use strict";(self.webpackChunkvue_admin_better=self.webpackChunkvue_admin_better||[]).push([["1129"],{58849:function(e,l,t){t.r(l),t.d(l,{createRole:function(){return o},deleteRole:function(){return d},getPermissionAll:function(){return s},getPermissionInfo:function(){return r},getRoleAll:function(){return i},getRoleInfo:function(){return n},updateRole:function(){return u}});var a=t(49289);async function s(){return(0,a.default)({url:"sys/permission",method:"get"})}async function r(e){return(0,a.default)({url:`sys/permission/${e}`,method:"get"})}async function o(e){return(0,a.default)({url:"sys/role",method:"post",data:e})}async function i(){return(0,a.default)({url:"sys/role",method:"get"})}async function n(e){return(0,a.default)({url:`sys/role/${e}`,method:"get"})}async function u(e,l){return(0,a.default)({url:`sys/role/${e}`,method:"patch",data:l})}async function d(e){return(0,a.default)({url:`sys/role/${e}`,method:"delete"})}},24030:function(e,l,t){var a=t(15058),s=t.n(a),r=t(9915),o=t.n(r)()(s());o.push([e.id,".permissions-container[data-v-305c31d6]{padding:20px}.permissions-container .el-tag[data-v-305c31d6]{margin-bottom:5px}",""]),l.A=o},49488:function(e,l,t){t.r(l),t.d(l,{default:function(){return C}});var a=t(79754);let s={class:"permissions-container"},r={style:{"margin-top":"16px","text-align":"right"}},o={class:"dialog-footer"},i={class:"dialog-footer"};var n=t(58849),u=t(77118),d=t(66270),c=t.n(d),m=t(38007),p=t.n(m),h=t(92669),g=t.n(h),b=t(23566),f=t.n(b),k=t(76106),y=t.n(k),_=t(12527),F=t.n(_),U=t(24030),V={};V.styleTagTransform=F(),V.setAttributes=f(),V.insert=g().bind(null,"head"),V.domAPI=p(),V.insertStyleElement=y(),c()(U.A,V),U.A&&U.A.locals&&U.A.locals;var C=(0,t(16784).default)({name:"Permissions",data:()=>({activeTab:"role",roleDialogVisible:!1,userDialogVisible:!1,currentRole:{id:"",name:"",permissions:[]},currentUser:{id:"",name:"",phone:"",roles:[]},roles:[],users:[],userPage:1,userPageSize:20,userTotal:0,permissionOptions:[],permissionMap:{},roleMap:{}}),created(){this.loadRoles(),this.loadPermissions(),this.loadUsers()},methods:{async loadRoles(){try{let e=(await (0,n.getRoleAll)()).data||[];this.roles=e.map(e=>({id:e.id,name:e.name,permissions:(e.permissions||[]).map(e=>e.code)})),this.roleMap=this.roles.reduce((e,l)=>(e[l.id]=l.name,e),{})}catch(e){console.error(e),this.$message.error("加载角色列表失败")}},editRole(e){this.currentRole={...e},this.roleDialogVisible=!0},async deleteRole(e){try{await (0,n.deleteRole)(e.id),this.$message.success(`删除角色: ${e.name}`),this.loadRoles()}catch(e){console.error(e),this.$message.error("删除角色失败")}},async saveRole(){try{await (0,n.updateRole)(this.currentRole.id,{name:this.currentRole.name,permissionCodes:this.currentRole.permissions}),this.$message.success("角色保存成功"),this.roleDialogVisible=!1,this.loadRoles()}catch(e){console.error(e),this.$message.error("角色保存失败")}},editUser(e){this.currentUser={...e},this.userDialogVisible=!0},async deleteUser(e){try{await (0,u.deleteUser)(e.id),this.$message.success(`删除用户: ${e.name}`),this.loadUsers()}catch(e){console.error(e),this.$message.error("删除用户失败")}},async saveUser(){try{let e={username:this.currentUser.name,phone:this.currentUser.phone,roleId:this.currentUser.roles[0]||null};await (0,u.update)(this.currentUser.id,e),this.$message.success("用户保存成功"),this.userDialogVisible=!1,this.loadUsers()}catch(e){console.error(e),this.$message.error("用户保存失败")}},async loadPermissions(){try{let e=(await (0,n.getPermissionAll)()).data||[];this.permissionOptions=e,this.permissionMap=e.reduce((e,l)=>(e[l.code]=l.description||l.code,e),{})}catch(e){console.error(e),this.$message.error("加载权限列表失败")}},async loadUsers(){try{let e=(await (0,u.getAll)({page:this.userPage,pageSize:this.userPageSize})).data||{},l=e.data||[],t=e.meta||{};this.users=l.map(e=>({id:e.id,name:e.username,phone:e.phone||e.remark||"",roles:e.roleId?[e.roleId]:[]})),this.userTotal=t.total||0,t.page&&(this.userPage=t.page),t.pageSize&&(this.userPageSize=t.pageSize)}catch(e){console.error(e),this.$message.error("加载用户列表失败")}},handleUserSizeChange(e){this.userPageSize=e,this.userPage=1,this.loadUsers()},handleUserCurrentChange(e){this.userPage=e,this.loadUsers()}}},[["render",function(e,l,t,n,u,d){let c=(0,a.g2)("el-table-column"),m=(0,a.g2)("el-tag"),p=(0,a.g2)("el-button"),h=(0,a.g2)("el-table"),g=(0,a.g2)("el-tab-pane"),b=(0,a.g2)("el-pagination"),f=(0,a.g2)("el-tabs"),k=(0,a.g2)("el-card"),y=(0,a.g2)("el-input"),_=(0,a.g2)("el-form-item"),F=(0,a.g2)("el-checkbox"),U=(0,a.g2)("el-checkbox-group"),V=(0,a.g2)("el-form"),C=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.CE)("div",s,[(0,a.bF)(k,{shadow:"never"},{default:(0,a.k6)(()=>[(0,a.bF)(f,{modelValue:u.activeTab,"onUpdate:modelValue":l[0]||(l[0]=e=>u.activeTab=e)},{default:(0,a.k6)(()=>[(0,a.bF)(g,{label:"角色权限",name:"role"},{default:(0,a.k6)(()=>[(0,a.bF)(h,{data:u.roles,style:{width:"100%"},"row-key":"id"},{default:(0,a.k6)(()=>[(0,a.bF)(c,{prop:"name",label:"角色名称",width:"180"}),(0,a.bF)(c,{label:"权限"},{default:(0,a.k6)(({row:e})=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.permissions,e=>((0,a.uX)(),(0,a.Wv)(m,{key:e,style:{"margin-right":"10px"}},{default:(0,a.k6)(()=>[(0,a.eW)((0,a.v_)(u.permissionMap[e]||e),1)]),_:2},1024))),128))]),_:1}),(0,a.bF)(c,{label:"操作",width:"180"},{default:(0,a.k6)(({row:e})=>[(0,a.bF)(p,{type:"text",onClick:l=>d.editRole(e)},{default:(0,a.k6)(()=>[...l[10]||(l[10]=[(0,a.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,a.bF)(p,{type:"text",onClick:l=>d.deleteRole(e)},{default:(0,a.k6)(()=>[...l[11]||(l[11]=[(0,a.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),(0,a.bF)(g,{label:"用户管理",name:"user"},{default:(0,a.k6)(()=>[(0,a.bF)(h,{data:u.users,style:{width:"100%"},"row-key":"id"},{default:(0,a.k6)(()=>[(0,a.bF)(c,{prop:"name",label:"用户名",width:"180"}),(0,a.bF)(c,{label:"角色"},{default:(0,a.k6)(({row:e})=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.roles,e=>((0,a.uX)(),(0,a.Wv)(m,{key:e,style:{"margin-right":"10px"}},{default:(0,a.k6)(()=>[(0,a.eW)((0,a.v_)(u.roleMap[e]||e),1)]),_:2},1024))),128))]),_:1}),(0,a.bF)(c,{prop:"phone",label:"电话",width:"200"}),(0,a.bF)(c,{label:"操作",width:"180"},{default:(0,a.k6)(({row:e})=>[(0,a.bF)(p,{type:"text",onClick:l=>d.editUser(e)},{default:(0,a.k6)(()=>[...l[12]||(l[12]=[(0,a.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,a.bF)(p,{type:"text",onClick:l=>d.deleteUser(e)},{default:(0,a.k6)(()=>[...l[13]||(l[13]=[(0,a.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),(0,a.Lk)("div",r,[(0,a.bF)(b,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":u.userPage,"page-size":u.userPageSize,"page-sizes":[10,20,50,100],total:u.userTotal,onSizeChange:d.handleUserSizeChange,onCurrentChange:d.handleUserCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,a.Q3)(" 角色编辑对话框 "),(0,a.bF)(C,{modelValue:u.roleDialogVisible,"onUpdate:modelValue":l[4]||(l[4]=e=>u.roleDialogVisible=e),title:"编辑角色",width:"500px"},{footer:(0,a.k6)(()=>[(0,a.Lk)("span",o,[(0,a.bF)(p,{onClick:l[3]||(l[3]=e=>u.roleDialogVisible=!1)},{default:(0,a.k6)(()=>[...l[14]||(l[14]=[(0,a.eW)("取消",-1)])]),_:1}),(0,a.bF)(p,{type:"primary",onClick:d.saveRole},{default:(0,a.k6)(()=>[...l[15]||(l[15]=[(0,a.eW)("保存",-1)])]),_:1},8,["onClick"])])]),default:(0,a.k6)(()=>[(0,a.bF)(V,{model:u.currentRole,"label-width":"80px"},{default:(0,a.k6)(()=>[(0,a.bF)(_,{label:"角色名称"},{default:(0,a.k6)(()=>[(0,a.bF)(y,{modelValue:u.currentRole.name,"onUpdate:modelValue":l[1]||(l[1]=e=>u.currentRole.name=e)},null,8,["modelValue"])]),_:1}),(0,a.bF)(_,{label:"权限"},{default:(0,a.k6)(()=>[(0,a.bF)(U,{modelValue:u.currentRole.permissions,"onUpdate:modelValue":l[2]||(l[2]=e=>u.currentRole.permissions=e)},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(u.permissionOptions,e=>((0,a.uX)(),(0,a.Wv)(F,{key:e.code,label:e.code},{default:(0,a.k6)(()=>[(0,a.eW)((0,a.v_)(e.description||e.code),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,a.Q3)(" 用户编辑对话框 "),(0,a.bF)(C,{modelValue:u.userDialogVisible,"onUpdate:modelValue":l[9]||(l[9]=e=>u.userDialogVisible=e),title:"编辑用户",width:"500px"},{footer:(0,a.k6)(()=>[(0,a.Lk)("span",i,[(0,a.bF)(p,{onClick:l[8]||(l[8]=e=>u.userDialogVisible=!1)},{default:(0,a.k6)(()=>[...l[16]||(l[16]=[(0,a.eW)("取消",-1)])]),_:1}),(0,a.bF)(p,{type:"primary",onClick:d.saveUser},{default:(0,a.k6)(()=>[...l[17]||(l[17]=[(0,a.eW)("保存",-1)])]),_:1},8,["onClick"])])]),default:(0,a.k6)(()=>[(0,a.bF)(V,{model:u.currentUser,"label-width":"80px"},{default:(0,a.k6)(()=>[(0,a.bF)(_,{label:"用户名"},{default:(0,a.k6)(()=>[(0,a.bF)(y,{modelValue:u.currentUser.name,"onUpdate:modelValue":l[5]||(l[5]=e=>u.currentUser.name=e)},null,8,["modelValue"])]),_:1}),(0,a.bF)(_,{label:"电话"},{default:(0,a.k6)(()=>[(0,a.bF)(y,{modelValue:u.currentUser.phone,"onUpdate:modelValue":l[6]||(l[6]=e=>u.currentUser.phone=e)},null,8,["modelValue"])]),_:1}),(0,a.bF)(_,{label:"角色"},{default:(0,a.k6)(()=>[(0,a.bF)(U,{modelValue:u.currentUser.roles,"onUpdate:modelValue":l[7]||(l[7]=e=>u.currentUser.roles=e)},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(u.roleMap,(e,l)=>((0,a.uX)(),(0,a.Wv)(F,{key:l,label:l},{default:(0,a.k6)(()=>[(0,a.eW)((0,a.v_)(e),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}],["__scopeId","data-v-305c31d6"]])}}]);