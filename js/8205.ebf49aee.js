"use strict";(self.webpackChunkvue_admin_better=self.webpackChunkvue_admin_better||[]).push([["8205"],{58315:function(e,a,t){t.r(a),t.d(a,{createForm:function(){return i},deleteForm:function(){return d},getForm:function(){return l},getForms:function(){return n},updateForm:function(){return o}});var r=t(49289);function n(e={}){return r.default.get("/form",{params:e}).then(e=>e.data)}function l(e){return r.default.get(`/form/${e}`).then(e=>e.data)}function i(e){return r.default.post("/form",e).then(e=>e.data)}function o(e,a){return r.default.patch(`/form/${e}`,a).then(e=>e.data)}function d(e){return r.default.delete(`/form/${e}`).then(()=>!0)}},77980:function(e,a,t){var r=t(26741),n=t.n(r),l=t(63494),i=t.n(l)()(n());i.push([e.id,'.designer-page[data-v-5c920f5d]{display:flex;flex-direction:column;gap:12px;padding:12px}.topbar[data-v-5c920f5d]{display:flex;align-items:center;gap:8px}.grow[data-v-5c920f5d]{flex:1}.w-56[data-v-5c920f5d]{width:260px}.w-40[data-v-5c920f5d]{width:200px}.w-72[data-v-5c920f5d]{width:320px}.designer-wrap[data-v-5c920f5d]{background:#fff;border:1px solid #ebeef5;border-radius:8px;padding:12px;height:calc(100vh - 120px);box-sizing:border-box}.designer-root[data-v-5c920f5d]{width:100%;height:100%;display:block}[data-v-5c920f5d] .fc-designer,[data-v-5c920f5d] .fc-container,[data-v-5c920f5d] .form-create{min-height:0}[data-v-5c920f5d] .fc-designer .fc-right{overflow:auto;--el-collapse-content-spacing: 0px}[data-v-5c920f5d] .fc-designer .fc-right .el-collapse-item__wrap,[data-v-5c920f5d] .fc-designer .fc-right .el-collapse-item__content{padding-bottom:0 !important}[data-v-5c920f5d] .fc-designer .fc-right .el-form .el-form-item{margin-bottom:8px}[data-v-5c920f5d] .fc-designer .fc-right .el-form .el-form-item:last-child{margin-bottom:0}[data-v-5c920f5d] .fc-designer .fc-right .el-row{margin-bottom:0}[data-v-5c920f5d] .fc-designer .fc-right .el-divider{margin:8px 0}[data-v-5c920f5d] .fc-designer .fc-right .el-scrollbar__view{min-height:auto !important}[data-v-5c920f5d] .fc-designer .fc-right [style*="visibility: hidden"]{display:none !important}',""]),a.A=i},6508:function(e,a,t){t.r(a),t.d(a,{default:function(){return F}});var r=t(65611),n=t(10365),l=t(67312),i=t(58315);let o={class:"designer-page"},d={class:"topbar"},u={class:"designer-wrap"},c={key:0,class:"preview-missing"};var s=t(66270),f=t.n(s),p=t(38007),m=t.n(p),v=t(92669),g=t.n(v),h=t(23566),y=t.n(h),w=t(76106),b=t.n(w),k=t(12527),A=t.n(k),x=t(77980),_={};_.styleTagTransform=A(),_.setAttributes=y(),_.insert=g().bind(null,"head"),_.domAPI=m(),_.insertStyleElement=b(),f()(x.A,_),x.A&&x.A.locals&&x.A.locals;var F=(0,t(4786).default)({__name:"index",setup(e){let a=(0,n.lq)(),t=(0,n.rd)(),s=(0,r.KR)(a.query.id?String(a.query.id):null),f=(0,r.EW)(()=>"new"===a.query.mode||!s.value),p=(0,r.KR)(null),m=(0,r.KR)({name:"",teamName:"",description:""}),v=(0,r.KR)(!1),g=(0,r.KR)(!1),h=(0,r.KR)({}),y=(0,r.KR)([]),w=(0,r.KR)({}),b=!!("undefined"!=typeof window&&(window.formCreate||window.$formCreate));function k(e){if(!Array.isArray(e))return[];let a=new Set(["row","col","group","tab","tabs","card","grid"]),t=e=>e&&e.props?e.props.innerHTML??e.props.html??e.children??"":e&&e.children||"";return function e(r){return(r||[]).filter(e=>e&&!(e&&"html"===e.type&&"string"==typeof t(e)&&/^\s*$/.test(t(e)))).map(a=>{let t={...a};return Array.isArray(t.children)&&(t.children=e(t.children).filter(Boolean)),t&&t.props&&Array.isArray(t.props.children)&&(t.props={...t.props,children:e(t.props.children).filter(Boolean)}),t&&t.options&&Array.isArray(t.options.children)&&(t.options={...t.options,children:e(t.options.children).filter(Boolean)}),t}).filter(e=>{let t=Array.isArray(e.children)&&e.children.length>0||e&&e.props&&Array.isArray(e.props.children)&&e.props.children.length>0||e&&e.options&&Array.isArray(e.options.children)&&e.options.children.length>0;return!a.has(e.type)||t})}(e)}async function A(){let e=p.value&&p.value.getRule?p.value.getRule():[],a=p.value&&p.value.getOption?p.value.getOption():{},r=k(e);if(!m.value.name||!m.value.teamName)return void l.n.warning("请填写模板名称和团队名称");v.value=!0;try{f.value?(await (0,i.createForm)({...m.value,ruleJson:r,optionJson:a}),l.n.success("模板创建成功"),t.back()):(await (0,i.updateForm)(s.value,{...m.value,ruleJson:r,optionJson:a}),l.n.success("模板更新成功"))}catch(e){l.n.error("保存失败："+(e&&e.message?e.message:"接口异常"))}finally{v.value=!1}}function x(){if(!b){l.n.warning("未注册 form-create 渲染器，无法预览"),g.value=!0;return}y.value=k(p.value&&p.value.getRule?p.value.getRule():[]),w.value=p.value&&p.value.getOption?p.value.getOption():{},g.value=!0}function _(){t.back()}return(0,r.sV)(async()=>{if(!f.value&&s.value)try{let e=await (0,i.getForm)(s.value);m.value={name:e&&e.name||"",teamName:e&&e.teamName||"",description:e&&e.description||""},await (0,r.dY)();let a=k(e&&e.ruleJson||[]),t=e&&e.optionJson||{};p.value&&p.value.setRule&&p.value.setRule(a),p.value&&p.value.setOption&&p.value.setOption(t)}catch(e){l.n.error("加载模板失败："+(e&&e.message?e.message:"接口异常"))}"true"===a.query.preview&&x()}),(e,a)=>{let t=(0,r.g2)("el-page-header"),n=(0,r.g2)("el-input"),l=(0,r.g2)("el-button"),i=(0,r.g2)("fc-designer"),s=(0,r.g2)("form-create"),k=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("div",d,[(0,r.bF)(t,{onBack:_},{content:(0,r.k6)(()=>[(0,r.Lk)("span",null,(0,r.v_)(f.value?"新建模板":"编辑模板"),1)]),_:1}),a[7]||(a[7]=(0,r.Lk)("div",{class:"grow"},null,-1)),(0,r.bF)(n,{modelValue:m.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value.name=e),placeholder:"模板名称",class:"w-56"},null,8,["modelValue"]),(0,r.bF)(n,{modelValue:m.value.teamName,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.teamName=e),placeholder:"团队名称",class:"w-40"},null,8,["modelValue"]),(0,r.bF)(n,{modelValue:m.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>m.value.description=e),placeholder:"模板描述",class:"w-72"},null,8,["modelValue"]),(0,r.bF)(l,{loading:v.value,type:"primary",onClick:A},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("保存",-1)])]),_:1},8,["loading"]),(0,r.bF)(l,{onClick:x},{default:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.eW)("预览",-1)])]),_:1})]),(0,r.Lk)("div",u,[(0,r.bF)(i,{ref_key:"designerRef",ref:p,class:"designer-root"},null,512)]),(0,r.bF)(k,{modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=e=>g.value=e),width:"70%",title:"表单预览","destroy-on-close":""},{default:(0,r.k6)(()=>[b?((0,r.uX)(),(0,r.Wv)(s,{key:1,modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value=e),rule:y.value,option:w.value},null,8,["modelValue","rule","option"])):((0,r.uX)(),(0,r.CE)("div",c,[...a[8]||(a[8]=[(0,r.eW)(" 未检测到 form-create 渲染器。请确认 main.js 已： ",-1),(0,r.Lk)("pre",null,"import formCreate from '@form-create/element-ui'\napp.use(formCreate)",-1)])]))]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5c920f5d"]])}}]);