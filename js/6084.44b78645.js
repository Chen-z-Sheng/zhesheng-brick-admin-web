"use strict";(self.webpackChunkvue_admin_better=self.webpackChunkvue_admin_better||[]).push([["6084"],{46729:function(e,a,t){async function n(e,{method:a="GET",body:t}={}){let l=await fetch(`/api${e}`,{method:a,headers:t?{"Content-Type":"application/json"}:void 0,body:t?JSON.stringify(t):void 0,credentials:"include"});if(!l.ok){let e=await l.text().catch(()=>"");throw Error(`HTTP ${l.status}: ${e||l.statusText}`)}return 204===l.status?null:l.json()}function l(e={}){let a=new URLSearchParams(e).toString();return n(`/templates${a?`?${a}`:""}`)}function r(e){return n(`/templates/${e}`)}function u(e){return n("/templates",{method:"POST",body:e})}function o(e,a){return n(`/templates/${e}`,{method:"PUT",body:a})}function i(e){return n(`/templates/${e}`,{method:"DELETE"})}function d(e){return n(`/templates/${e}/duplicate`,{method:"POST"})}function s(e,a={}){let t=new URLSearchParams(a).toString();return n(`/templates/${e}/render${t?`?${t}`:""}`)}t.r(a),t.d(a,{createTemplate:function(){return u},deleteTemplate:function(){return i},duplicateTemplate:function(){return d},getTemplateDetail:function(){return r},getTemplateRender:function(){return s},getTemplates:function(){return l},updateTemplate:function(){return o}})},72955:function(e,a,t){var n=t(26741),l=t.n(n),r=t(63494),u=t.n(r)()(l());u.push([e.id,".designer-page[data-v-a262b6aa]{display:flex;flex-direction:column;gap:12px;padding:12px}.topbar[data-v-a262b6aa]{display:flex;align-items:center;gap:8px}.grow[data-v-a262b6aa]{flex:1}.w-56[data-v-a262b6aa]{width:260px}.w-40[data-v-a262b6aa]{width:200px}.w-72[data-v-a262b6aa]{width:320px}.designer-wrap[data-v-a262b6aa]{background:#fff;border:1px solid #ebeef5;border-radius:8px;padding:12px}.designer-root[data-v-a262b6aa]{width:100%;height:auto;min-height:700px;display:block}[data-v-a262b6aa] .fc-designer,[data-v-a262b6aa] .fc-container,[data-v-a262b6aa] .form-create{min-height:700px}.preview-missing[data-v-a262b6aa]{font-size:13px;color:#666;background:#f9fafb;border:1px dashed #e5e7eb;border-radius:8px;padding:12px;white-space:pre-wrap}",""]),a.A=u},77855:function(e,a,t){t.r(a),t.d(a,{default:function(){return V}});var n=t(65611),l=t(10365),r=t(67312),u=t(46729);let o={class:"designer-page"},i={class:"topbar"},d={class:"designer-wrap"},s={key:0,class:"preview-missing"};var p=t(66270),c=t.n(p),m=t(38007),v=t.n(m),f=t(92669),g=t.n(f),b=t(23566),w=t.n(b),h=t(76106),y=t.n(h),k=t(12527),x=t.n(k),T=t(72955),_={};_.styleTagTransform=x(),_.setAttributes=w(),_.insert=g().bind(null,"head"),_.domAPI=v(),_.insertStyleElement=y(),c()(T.A,_),T.A&&T.A.locals&&T.A.locals;var V=(0,t(4786).default)({__name:"index",setup(e){let a=(0,l.lq)(),t=(0,l.rd)(),p=(0,n.KR)(a.query.id?String(a.query.id):null),c=(0,n.EW)(()=>"new"===a.query.mode||!p.value),m=(0,n.KR)(null),v=(0,n.KR)({name:"",teamName:"",description:""}),f=(0,n.KR)(!1),g=(0,n.KR)(!1),b=(0,n.KR)({}),w=(0,n.KR)([]),h=(0,n.KR)({}),y=!!("undefined"!=typeof window&&(window.formCreate||window.$formCreate));async function k(){let e=m.value?.getRule?.()||[],a=m.value?.getOption?.()||[];if(!v.value.name||!v.value.teamName)return void r.n.warning("请填写模板名称和团队名称");f.value=!0;try{c.value?(await (0,u.createTemplate)({...v.value,rule_json:e,option_json:a}),r.n.success("模板创建成功"),t.back()):(await (0,u.updateTemplate)(p.value,{...v.value,rule_json:e,option_json:a}),r.n.success("模板更新成功"))}catch(e){r.n.error("保存失败："+(e?.message||"接口异常"))}finally{f.value=!1}}function x(){if(!y){r.n.warning("未注册 form-create 渲染器，无法预览"),g.value=!0;return}w.value=m.value?.getRule?.()||[],h.value=m.value?.getOption?.()||{},g.value=!0}function T(){t.back()}return(0,n.sV)(async()=>{if(!c.value&&p.value)try{let e=await (0,u.getTemplateDetail)(p.value);v.value={name:e.name||"",teamName:e.teamName||"",description:e.description||""},await (0,n.dY)(),m.value?.setRule?.(e.rule_json||[]),m.value?.setOption?.(e.option_json||{})}catch(e){r.n.error("加载模板失败："+(e?.message||"接口异常"))}"true"===a.query.preview&&x()}),(e,a)=>{let t=(0,n.g2)("el-page-header"),l=(0,n.g2)("el-input"),r=(0,n.g2)("el-button"),u=(0,n.g2)("fc-designer"),p=(0,n.g2)("form-create"),_=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)("div",o,[(0,n.Q3)(" 顶部工具栏 "),(0,n.Lk)("div",i,[(0,n.bF)(t,{onBack:T},{content:(0,n.k6)(()=>[(0,n.Lk)("span",null,(0,n.v_)(c.value?"新建模板":"编辑模板"),1)]),_:1}),a[7]||(a[7]=(0,n.Lk)("div",{class:"grow"},null,-1)),(0,n.bF)(l,{modelValue:v.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value.name=e),placeholder:"模板名称",class:"w-56"},null,8,["modelValue"]),(0,n.bF)(l,{modelValue:v.value.teamName,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value.teamName=e),placeholder:"团队名称",class:"w-40"},null,8,["modelValue"]),(0,n.bF)(l,{modelValue:v.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value.description=e),placeholder:"模板描述",class:"w-72"},null,8,["modelValue"]),(0,n.bF)(r,{loading:f.value,type:"primary",onClick:k},{default:(0,n.k6)(()=>[...a[5]||(a[5]=[(0,n.eW)("保存",-1)])]),_:1},8,["loading"]),(0,n.bF)(r,{onClick:x},{default:(0,n.k6)(()=>[...a[6]||(a[6]=[(0,n.eW)("预览",-1)])]),_:1})]),(0,n.Q3)(" 设计器区域：不再缩放，不再内滚动，自然铺开 "),(0,n.Lk)("div",d,[(0,n.bF)(u,{ref_key:"designerRef",ref:m,class:"designer-root"},null,512)]),(0,n.Q3)(" 预览弹窗 "),(0,n.bF)(_,{modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=e=>g.value=e),width:"70%",title:"表单预览","destroy-on-close":""},{default:(0,n.k6)(()=>[y?((0,n.uX)(),(0,n.Wv)(p,{key:1,modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=e=>b.value=e),rule:w.value,option:h.value},null,8,["modelValue","rule","option"])):((0,n.uX)(),(0,n.CE)("div",s,[...a[8]||(a[8]=[(0,n.eW)(" 未检测到 form-create 渲染器。请在 main.js 注册后再试： ",-1),(0,n.Lk)("pre",null,"import formCreate from '@form-create/element-ui'\napp.use(formCreate)",-1)])]))]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-a262b6aa"]])}}]);