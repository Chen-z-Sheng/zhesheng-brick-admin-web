"use strict";(self.webpackChunkvue_admin_better=self.webpackChunkvue_admin_better||[]).push([["5721"],{60466:function(e,a,t){t.r(a),t.d(a,{createFormTemplate:function(){return d},deleteFormTemplate:function(){return o},getFormTemplate:function(){return n},getFormTemplates:function(){return l},updateFormTemplate:function(){return i}});var r=t(49289);function l(e={}){return r.default.get("/admin/form-template",{params:e}).then(e=>e.data)}function n(e){return r.default.get(`/admin/form-template/${e}`).then(e=>e.data)}function d(e){return r.default.post("/admin/form-template",e).then(e=>e.data)}function i(e,a){return r.default.patch(`/admin/form-template/${e}`,a).then(e=>e.data)}function o(e){return r.default.delete(`/admin/form-template/${e}`).then(()=>!0)}},29784:function(e,a,t){var r=t(15058),l=t.n(r),n=t(9915),d=t.n(n)()(l());d.push([e.id,'.designer-page[data-v-5d29c5d8]{display:flex;flex-direction:column;gap:12px;padding:12px}.topbar[data-v-5d29c5d8]{display:flex;align-items:center;gap:8px}.grow[data-v-5d29c5d8]{flex:1}.w-56[data-v-5d29c5d8]{width:260px}.w-40[data-v-5d29c5d8]{width:200px}.w-72[data-v-5d29c5d8]{width:320px}.designer-wrap[data-v-5d29c5d8]{background:#fff;border:1px solid #ebeef5;border-radius:8px;padding:12px;height:calc(100vh - 120px);box-sizing:border-box}.designer-root[data-v-5d29c5d8]{width:100%;height:100%;display:block}[data-v-5d29c5d8] .fc-designer,[data-v-5d29c5d8] .fc-container,[data-v-5d29c5d8] .form-create{min-height:0}[data-v-5d29c5d8] .fc-designer .fc-right{overflow:auto;--el-collapse-content-spacing: 0px}[data-v-5d29c5d8] .fc-designer .fc-right .el-collapse-item__wrap,[data-v-5d29c5d8] .fc-designer .fc-right .el-collapse-item__content{padding-bottom:0 !important}[data-v-5d29c5d8] .fc-designer .fc-right .el-form .el-form-item{margin-bottom:8px}[data-v-5d29c5d8] .fc-designer .fc-right .el-form .el-form-item:last-child{margin-bottom:0}[data-v-5d29c5d8] .fc-designer .fc-right .el-row{margin-bottom:0}[data-v-5d29c5d8] .fc-designer .fc-right .el-divider{margin:8px 0}[data-v-5d29c5d8] .fc-designer .fc-right .el-scrollbar__view{min-height:auto !important}[data-v-5d29c5d8] .fc-designer .fc-right [style*="visibility: hidden"]{display:none !important}',""]),a.A=d},60864:function(e,a,t){t.r(a),t.d(a,{default:function(){return F}});var r=t(79754),l=t(79458),n=t(29986),d=t(60466);let i={class:"designer-page"},o={class:"topbar"},u={class:"designer-wrap"},c={key:0,class:"preview-missing"};var s=t(66270),p=t.n(s),m=t(38007),f=t.n(m),v=t(92669),g=t.n(v),h=t(23566),y=t.n(h),w=t(76106),b=t.n(w),k=t(12527),A=t.n(k),_=t(29784),x={};x.styleTagTransform=A(),x.setAttributes=y(),x.insert=g().bind(null,"head"),x.domAPI=f(),x.insertStyleElement=b(),p()(_.A,x),_.A&&_.A.locals&&_.A.locals;var F=(0,t(16784).default)({__name:"designer",setup(e){let a=(0,l.lq)(),t=(0,l.rd)(),s=(0,r.KR)(a.query.id?String(a.query.id):null),p=(0,r.EW)(()=>"new"===a.query.mode||!s.value),m=(0,r.KR)(null),f=(0,r.KR)({name:"",teamName:"",description:""}),v=(0,r.KR)(!1),g=(0,r.KR)(!1),h=(0,r.KR)({}),y=(0,r.KR)([]),w=(0,r.KR)({}),b=!!("undefined"!=typeof window&&(window.formCreate||window.$formCreate));function k(e){if(!Array.isArray(e))return[];let a=new Set(["row","col","group","tab","tabs","card","grid"]),t=e=>e&&e.props?e.props.innerHTML??e.props.html??e.children??"":e&&e.children||"";return function e(r){return(r||[]).filter(e=>e&&!(e&&"html"===e.type&&"string"==typeof t(e)&&/^\s*$/.test(t(e)))).map(a=>{let t={...a};return Array.isArray(t.children)&&(t.children=e(t.children).filter(Boolean)),t&&t.props&&Array.isArray(t.props.children)&&(t.props={...t.props,children:e(t.props.children).filter(Boolean)}),t&&t.options&&Array.isArray(t.options.children)&&(t.options={...t.options,children:e(t.options.children).filter(Boolean)}),t}).filter(e=>{let t=Array.isArray(e.children)&&e.children.length>0||e&&e.props&&Array.isArray(e.props.children)&&e.props.children.length>0||e&&e.options&&Array.isArray(e.options.children)&&e.options.children.length>0;return!a.has(e.type)||t})}(e)}async function A(){let e=m.value&&m.value.getRule?m.value.getRule():[],a=m.value&&m.value.getOption?m.value.getOption():{},r=k(e);if(!f.value.name||!f.value.teamName)return void n.n.warning("请填写模板名称和团队名称");v.value=!0;try{p.value?(await (0,d.createFormTemplate)({...f.value,ruleJson:r,optionJson:a}),n.n.success("模板创建成功"),t.back()):(await (0,d.updateFormTemplate)(s.value,{...f.value,ruleJson:r,optionJson:a}),n.n.success("模板更新成功"))}catch(e){n.n.error("保存失败："+(e&&e.message?e.message:"接口异常"))}finally{v.value=!1}}function _(){if(!b){n.n.warning("未注册 form-create 渲染器，无法预览"),g.value=!0;return}y.value=k(m.value&&m.value.getRule?m.value.getRule():[]),w.value=m.value&&m.value.getOption?m.value.getOption():{},g.value=!0}function x(){t.back()}return(0,r.sV)(async()=>{if(!p.value&&s.value)try{let e=await (0,d.getFormTemplate)(s.value);f.value={name:e&&e.name||"",teamName:e&&e.teamName||"",description:e&&e.description||""},await (0,r.dY)();let a=k(e&&e.ruleJson||[]),t=e&&e.optionJson||{};m.value&&m.value.setRule&&m.value.setRule(a),m.value&&m.value.setOption&&m.value.setOption(t)}catch(e){n.n.error("加载模板失败："+(e&&e.message?e.message:"接口异常"))}"true"===a.query.preview&&_()}),(e,a)=>{let t=(0,r.g2)("el-page-header"),l=(0,r.g2)("el-input"),n=(0,r.g2)("el-button"),d=(0,r.g2)("fc-designer"),s=(0,r.g2)("form-create"),k=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.Lk)("div",o,[(0,r.bF)(t,{onBack:x},{content:(0,r.k6)(()=>[(0,r.Lk)("span",null,(0,r.v_)(p.value?"新建模板":"编辑模板"),1)]),_:1}),a[7]||(a[7]=(0,r.Lk)("div",{class:"grow"},null,-1)),(0,r.bF)(l,{modelValue:f.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value.name=e),placeholder:"模板名称",class:"w-56"},null,8,["modelValue"]),(0,r.bF)(l,{modelValue:f.value.teamName,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value.teamName=e),placeholder:"团队名称",class:"w-40"},null,8,["modelValue"]),(0,r.bF)(l,{modelValue:f.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value.description=e),placeholder:"模板描述",class:"w-72"},null,8,["modelValue"]),(0,r.bF)(n,{loading:v.value,type:"primary",onClick:A},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("保存",-1)])]),_:1},8,["loading"]),(0,r.bF)(n,{onClick:_},{default:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.eW)("预览",-1)])]),_:1})]),(0,r.Lk)("div",u,[(0,r.bF)(d,{ref_key:"designerRef",ref:m,class:"designer-root"},null,512)]),(0,r.bF)(k,{modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=e=>g.value=e),width:"70%",title:"表单预览","destroy-on-close":""},{default:(0,r.k6)(()=>[b?((0,r.uX)(),(0,r.Wv)(s,{key:1,modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value=e),rule:y.value,option:w.value},null,8,["modelValue","rule","option"])):((0,r.uX)(),(0,r.CE)("div",c,[...a[8]||(a[8]=[(0,r.eW)(" 未检测到 form-create 渲染器。请确认 main.js 已： ",-1),(0,r.Lk)("pre",null,"import formCreate from '@form-create/element-ui'\n          app.use(formCreate)",-1)])]))]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5d29c5d8"]])}}]);